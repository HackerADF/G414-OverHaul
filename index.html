<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G414 Chess Engine</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>♛</text></svg>" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<div id="app">

  <!-- ── Header ──────────────────────────────────────────── -->
  <header>
    <h1>G414 Chess Engine</h1>
    <div class="controls">
      <button class="btn" id="btn-theme" title="Toggle theme">☀</button>
      <button class="btn" id="btn-flip">Flip Board</button>
      <button class="btn" id="btn-new">New Game</button>
      <button class="btn primary" id="btn-analyze">Analyze</button>
      <button class="btn" id="btn-stop">Stop</button>
      <button class="btn" id="btn-play-engine">▶ Play vs Engine</button>
      <button class="btn" id="btn-heatmap">Heat Map</button>
      <button class="btn" id="btn-svs">⚙ Self vs Self</button>
    </div>
  </header>

  <!-- ── Left Panel ──────────────────────────────────────── -->
  <aside id="left-panel">

    <div class="panel-card">
      <h3>Engine Settings</h3>
      <label>Depth <span id="depth-val">12</span></label>
      <input type="range" id="depth-slider" min="1" max="20" value="12" />
      <label>Lines (MultiPV) <span id="lines-val">8</span></label>
      <input type="range" id="lines-slider" min="1" max="32" value="8" />
      <label>Worker threads <span id="workers-val">8</span></label>
      <input type="range" id="workers-slider" min="1" max="16" value="8" />
      <label>Plans (concurrent)</label>
      <input type="number" id="plans-input" value="256" min="8" max="512" step="8" />
    </div>

    <div class="panel-card">
      <h3>Position</h3>
      <label>FEN</label>
      <input type="text" id="fen-input" value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1" />
      <div class="controls">
        <button class="btn" id="btn-load-fen">Load FEN</button>
        <button class="btn" id="btn-copy-fen">Copy FEN</button>
        <button class="btn" id="btn-copy-pgn">Copy PGN</button>
      </div>
    </div>

    <div class="panel-card" id="svs-panel" style="display:none;">
      <h3>Self vs Self</h3>
      <label>Move delay <span id="svs-delay-val">500</span> ms</label>
      <input type="range" id="svs-delay" min="100" max="3000" step="100" value="500" />
      <label style="display:flex;align-items:center;gap:6px;cursor:pointer;margin-top:4px;">
        <input type="checkbox" id="svs-auto-restart" /> Auto-restart on game over
      </label>
      <div id="svs-stats" style="font-size:0.78rem;color:var(--text-muted);line-height:1.8;margin-top:6px;"></div>
    </div>

    <div class="panel-card" style="flex:1; min-height:0;">
      <h3>Move History</h3>
      <div id="move-list"></div>
    </div>

  </aside>

  <!-- ── Board Area ───────────────────────────────────────── -->
  <main id="board-area">

    <div id="eval-bar-wrap">
      <div id="eval-bar"><div id="eval-fill"></div></div>
      <span id="eval-score">0.00</span>
    </div>

    <div id="board-container">
      <div id="board"></div>
      <canvas id="lines-canvas"></canvas>
      <div id="game-over-banner"></div>
    </div>

  </main>

  <!-- ── Right Panel ─────────────────────────────────────── -->
  <aside id="right-panel">

    <div class="panel-card" style="flex:1; min-height:0; overflow:hidden; display:flex; flex-direction:column;">
      <h3>Analysis Lines <span id="lines-count" style="color:var(--accent)"></span></h3>
      <div id="plans-progress-wrap" style="display:none; flex-direction:column; gap:2px;">
        <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:var(--text-muted);">
          <span>Plans</span><span id="plans-progress-label">0 / 0</span>
        </div>
        <div style="height:4px; background:var(--surface2); border-radius:2px; overflow:hidden;">
          <div id="plans-progress-bar" style="height:100%; background:var(--accent); width:0%; transition:width 0.3s;"></div>
        </div>
      </div>
      <div id="lines-list"></div>
    </div>

    <div class="panel-card">
      <h3>Engine Info</h3>
      <div id="engine-info" style="font-size:0.78rem; color:var(--text-muted); line-height:1.6;"></div>
    </div>

  </aside>

  <!-- ── Status Bar ───────────────────────────────────────── -->
  <footer id="status-bar">
    <span id="status-text">Ready</span>
    <span id="nps-text"></span>
    <span id="time-text"></span>
  </footer>

</div>

<!-- Promotion Dialog -->
<div id="promo-dialog">
  <div class="promo-box" id="promo-box"></div>
</div>

<script src="js/chess.js"></script>
<script src="js/pieces.js"></script>
<script src="js/board.js"></script>
<script src="js/engine.js"></script>
<script src="js/analysis.js"></script>
<script src="js/ui.js"></script>
<script src="js/main.js"></script>
</body>
</html>
